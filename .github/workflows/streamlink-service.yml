name: streamlink-service

on: [push, workflow_dispatch]

jobs:
  deploy:

    runs-on: ubuntu-latest

    steps:
    - name: streamlink-service deployment
      env:
        TRAVIS_TOKEN: ${{ secrets.TRAVIS_TOKEN }}
        TRIGGER_REPO: ${{ secrets.TRIGGER_REPO }}
        BODY: '{ "request": { "branch":"master" } }'
      run: |
        curl -s -X POST                             \
            -H "Content-Type: application/json"     \
            -H "Accept: application/json"           \
            -H "Travis-API-Version: 3"              \
            -H "Authorization: token $TRAVIS_TOKEN" \
            -d "$BODY"                              \
        https://api.travis-ci.org/repo/$TRIGGER_REPO/requests
    - name: streamlink-service workflow
      env:
        STREAMLINK_SERVICE_TOKEN: ${{ secrets.STREAMLINK_SERVICE_TOKEN }}
        ENDPOINT: "vstavrinov/streamlink-service/actions/workflows/main.yml"
      run: |
        curl -s -X POST                                         \
            -H "Accept: application/vnd.github.v3+json"         \
            -H "Authorization: token $STREAMLINK_SERVICE_TOKEN" \
            -d '{"ref": "master"}'                              \
        https://api.github.com/repos/$ENDPOINT/dispatches
